# AIMDS Cargo Configuration for Optimized WASM Builds

[build]
# Use all available CPU cores for compilation
jobs = -1

[target.wasm32-unknown-unknown]
# WASM-specific rustflags for size optimization
rustflags = [
    "-C", "link-arg=-zstack-size=131072",  # 128KB stack
    "-C", "target-feature=+bulk-memory",    # Enable bulk memory operations
    "-C", "target-feature=+mutable-globals",
    "-C", "target-feature=+sign-ext",
]

# Alternative build command for WASM
# Use: cargo wasm-build
[alias]
wasm-build = "build --target wasm32-unknown-unknown --features wasm --profile wasm-release --no-default-features"
wasm-check = "check --target wasm32-unknown-unknown --features wasm --no-default-features"
wasm-test = "test --target wasm32-unknown-unknown --features wasm --no-default-features"
wasm-clean = "clean --target wasm32-unknown-unknown"

# Profile for size-optimized WASM builds
[profile.wasm-release]
inherits = "release"
opt-level = "z"
lto = true
codegen-units = 1
panic = "abort"
strip = true
overflow-checks = false
debug = false
debug-assertions = false
rpath = false

# Profile for balanced WASM builds (faster compile, slightly larger)
[profile.wasm-balanced]
inherits = "release"
opt-level = 3
lto = "thin"
codegen-units = 4
panic = "abort"
strip = true

# Profile for development WASM builds
[profile.wasm-dev]
inherits = "dev"
opt-level = 1
panic = "abort"
